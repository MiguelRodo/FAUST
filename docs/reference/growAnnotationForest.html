<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Faster Annotation Using Shape-constrained Trees — growAnnotationForest • faust</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Faster Annotation Using Shape-constrained Trees — growAnnotationForest" />
<meta property="og:description" content="growAnnotationForest is used to produce an annotation forest for a dataSet." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">faust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/faustIntro.html">Intro to FAUST R package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/FredHutch/faust/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Faster Annotation Using Shape-constrained Trees</h1>
    <small class="dont-index">Source: <a href='https://github.com/FredHutch/faust/blob/master/R/growAnnotationForest.R'><code>R/growAnnotationForest.R</code></a></small>
    <div class="hidden name"><code>growAnnotationForest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>growAnnotationForest is used to produce an annotation forest for a dataSet.</p>
    </div>

    <pre class="usage"><span class='fu'>growAnnotationForest</span>(
  <span class='no'>dataSet</span>,
  <span class='kw'>numberIterations</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>pValueThreshold</span> <span class='kw'>=</span> <span class='fl'>0.35</span>,
  <span class='kw'>minimumClusterSize</span> <span class='kw'>=</span> <span class='fl'>25</span>,
  <span class='kw'>maximumSearchDepth</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dataSet</span>),
  <span class='kw'>maximumGatingNum</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>maximumAntimodeNumber</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>maximumSearchTime</span> <span class='kw'>=</span> <span class='fl'>1e+06</span>,
  <span class='kw'>maximumRunTime</span> <span class='kw'>=</span> <span class='fl'>1e+06</span>,
  <span class='kw'>annotationVec</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dataSet</span>),
  <span class='kw'>numberOfThreads</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>randomCandidateSearch</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>anyValueRestricted</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>resValMatrix</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0</span>, <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='fl'>2</span>),
  <span class='kw'>getDebugInfo</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>cutPointUpperBound</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>gaussianScaleParameter</span> <span class='kw'>=</span> <span class='fl'>4</span>,
  <span class='kw'>randomSeed</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>allowRepeatedSplitting</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>subSamplingThreshold</span> <span class='kw'>=</span> <span class='fl'>1e+06</span>,
  <span class='kw'>subSampleSize</span> <span class='kw'>=</span> <span class='fl'>1e+06</span>,
  <span class='kw'>subSampleIter</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>recordCounts</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>recordIndices</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dataSet</th>
      <td><p>The input dataSet to be clustered by faust.
Must be an R matrix. The dataSet should only contain numerical data.</p></td>
    </tr>
    <tr>
      <th>numberIterations</th>
      <td><p>The number of faust iterations to perform.</p></td>
    </tr>
    <tr>
      <th>pValueThreshold</th>
      <td><p>The significance level for the DIP test of Hartigan
and Hartigan (1985). faust uses this level to choose to partition a projection
in the dataSet with the taut-string of Davies and Kovac (2004). Setting it
to smaller values (such as a conventional 0.05) usually produces faster
exaustive clusterings of the dataSet.</p></td>
    </tr>
    <tr>
      <th>minimumClusterSize</th>
      <td><p>The size of the smallest admissible candidate cluster.
The recursive search for candidate clusters will not consider subsets of observations
below this value as admissible candidates -- it terminates along such branches without
recording the subsets encountered. Increasing this parameter usually increases
the speed of a single faust iteration.</p></td>
    </tr>
    <tr>
      <th>maximumSearchDepth</th>
      <td><p>An upper bound on the depth of a search tree for candidate clusters.
The recursive search terminates if it exceeds this depth. Since the annotation forest
is contructing boundaries relative to a <em>population</em>, it is set to a low default number.</p>
<p>This is done under the assumption that a search path that terminates far down a gating tree
is potentially finding differences that are not reflective of population boundaries.</p></td>
    </tr>
    <tr>
      <th>maximumGatingNum</th>
      <td><p>An upper bound on the number of gating examples in the annotatino forest.
If a faust iteration is exhaustively searching the space of clustering trees, the search will
terminate if faust finds a collection of candidate clusters that exceed this bound.</p>
<p>If a faust iteration performs a randomCandidateSearch (or if any values are restricted in the search
process using the resValMatrix) <em><b>the faust search will continue until it
finds this number of gating examples</b></em>.</p></td>
    </tr>
    <tr>
      <th>maximumAntimodeNumber</th>
      <td><p>An upper bound on the number of possible antimodes found by the
taut-string estimate of a projection. If the taut-string produces more than the
maximumAntimodeNumber number of antimodes, the recursive search terminates along that branch.</p></td>
    </tr>
    <tr>
      <th>maximumSearchTime</th>
      <td><p>The maximum time in seconds a faust iteration can search for candidate
clusters. If a single iteration exceeds this value in either the intial search phase or
and residual search phases, that faust iteration is abandonded and the next iteration is
attempted.</p>
<p>On large dataSets (with either a large number of observations or variables), the
initial addition of noise can produce configurations of the dataSet which take much longer
to cluster than the average faust iteration. This parameter is useful to prevent such iterations
from extending a single faust call from running too long.</p></td>
    </tr>
    <tr>
      <th>maximumRunTime</th>
      <td><p>The total time in seconds allowed for the growth of the annotation forest.
If this time is exceeding during a FAUST iteration, the iteration will take as long as needed to finish
before the annotation forest is returned to the user.</p></td>
    </tr>
    <tr>
      <th>annotationVec</th>
      <td><p>A vector of strings that will be used to annotate the components of the annotation forest.
For the faust clustering to be interpetable, meaningful strings must be provided here.</p></td>
    </tr>
    <tr>
      <th>numberOfThreads</th>
      <td><p>The addition of noise to the dataSet and the random search for gate locations
are parallelized. For numberOfThreads greater than 2, numberOfThreads-1 worker threads will add
noise to the dataSet, conduct the search for candidate clusters, and annotate the selected clusters.
The default value of 0 indicates faust should detect the maximum number of threads supported by the hardware
and then use that value.</p></td>
    </tr>
    <tr>
      <th>randomCandidateSearch</th>
      <td><p>Boolean flag. If true, the initial search for candidate clusters will
sample from the space of clustering trees. At each node in the clustering tree, faust will pick
the next clustering branch uniformly at random the set of admissible projections (according to the dip).
Especially in small dataSets, this can cause the faust search to find the same clustering tree multiple
times.</p></td>
    </tr>
    <tr>
      <th>anyValueRestricted</th>
      <td><p>Boolean flag. If true, indicates the user has some prior knowledge about bounds of
admissible values. Such values must be identified by coordinate projection in the resValMatrix.</p>
<p>The motivation for this parameter is that some technologies produce dataSets which are: very zero-inflated;
have a minimum limit of detection; have an upper limit of detection. Hence, one might wish to indicate that
all values below some threshold be treated as low <em>by default</em>, or above a threshold be treated as high
<em>by default</em>. Of critical importance: restricted values <em><b>are not used by the taut-string density estimator
in the search for candidate clusters</b></em>.</p></td>
    </tr>
    <tr>
      <th>resValMatrix</th>
      <td><p>R matrix indicating restricted values. Contains only three entries: 0,1,2. If entry (i,j) is 0, it indicates
that observation i is unrestricted along coordinate j (and so is used by the taut-string in the search for cnadidate clusters).</p>
<p>If entry (i,j) is 1, it indicates observation i is <em>restricted from below</em> along coordinate j: this observation will
automatically be treated as "Lowest" along coordinate j, and will not be used by the taut-string in the search for candidate clusters.</p>
<p>If entry (i,j) is 2, it indicates observation i is <em>restricted from above</em> along coordinate j: this observation will
automatically be treated as "Highest" along coordinate j, and will not be used by the taut-string in the search for candidate clusters.</p></td>
    </tr>
    <tr>
      <th>getDebugInfo</th>
      <td><p>Boolean flag. If true, debugging info pertaining to the annotation forest is printed to file.</p></td>
    </tr>
    <tr>
      <th>cutPointUpperBound</th>
      <td><p>Integer upper bound on the number of cut points that will be collected
for a column projection during the construction of the annotation forest. If, during the search for candidate clusters,
faust partitions a column projection into a number of modal groups that exceeds this number, the search will proceed
but the location of the cut points will not be added to the annotation forest.</p></td>
    </tr>
    <tr>
      <th>gaussianScaleParameter</th>
      <td><p>Noise is added in a two-step procedure for FAUST. First, uniform noise is added to
break ties observed in the columns of the dataSet. After uniform noise is added, Gaussian noise is added to perturb
the relative order of the observations in each column of the dataSet. The standard-devaition of the Gaussian noise
depends on the distance to the neighboring order statistics of an observation.</p>
<p>The default value of 4.0 preserves the relative ordering of observations in a column, with high probability. As the
value decreases, observations are more and more likely to switch position in the order-statistics.</p></td>
    </tr>
    <tr>
      <th>randomSeed</th>
      <td><p>Set to a large integer value to reproduce faust runs when numberOfThreads==1.
Default value of 0 leads to non-reproducible FAUST runs regardless of numberOfThreads value.</p></td>
    </tr>
    <tr>
      <th>allowRepeatedSplitting</th>
      <td><p>Set to FALSE by default. If TRUE, indicates the search for candidate clusters can
induce modal clusters along the same column vector of dataSet multiple times throughout the search. No matter
the value of this parameter (TRUE OR FALSE), the search for candidate clusters is never allowed to induce modal clusters
along the same column vector twice in a row: from the point of view of FAUST, this can only arise due to technical
error.</p></td>
    </tr>
    <tr>
      <th>subSamplingThreshold</th>
      <td><p>Determines how large a data matrix needs to be in order to start sub-sampling for density
estimation.</p></td>
    </tr>
    <tr>
      <th>subSampleSize</th>
      <td><p>Number of observations a conditional density will sample.</p></td>
    </tr>
    <tr>
      <th>subSampleIter</th>
      <td><p>Number of sub-sampling iterations.</p></td>
    </tr>
    <tr>
      <th>recordCounts</th>
      <td><p>Record counts of which observations are split at different levels of annotation forest.
Memory intensive. In runs using multiple threads, each thread maintains a local copy of a count matrix with
the same dimensions as the data set, and counts are copied to the master thread.</p></td>
    </tr>
    <tr>
      <th>recordIndices</th>
      <td><p>Record boolean vector of indices.
Memory intensive. Used for conditional plotting.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>growAnnotationForest returns an R list with ncol(dataSet) entires. Each entry corresponds to a column in dataSet.
Each entry in the list is a vector of cut points placed by faust along that column projection in the search for
candidate clusters. The distribution of cut points can be used to set annotation boundaries for the
annForestVals in the faust function.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>clusterMatrix</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='no'>iris</span>[,-<span class='fl'>5</span>])
<span class='no'>annotationForest</span> <span class='kw'>&lt;-</span> <span class='fu'>growAnnotationForest</span>(<span class='kw'>dataSet</span><span class='kw'>=</span><span class='no'>clusterMatrix</span>,
                         <span class='kw'>numberIterations</span><span class='kw'>=</span><span class='fl'>1000</span>)</div><div class='output co'>#&gt; [1] "remaining iterations: 1000"
#&gt; [1] "remaining iterations: 900"
#&gt; [1] "remaining iterations: 800"
#&gt; [1] "remaining iterations: 700"
#&gt; [1] "remaining iterations: 600"
#&gt; [1] "remaining iterations: 500"
#&gt; [1] "remaining iterations: 400"
#&gt; [1] "remaining iterations: 300"
#&gt; [1] "remaining iterations: 200"
#&gt; [1] "remaining iterations: 100"</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Evan Greene.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


